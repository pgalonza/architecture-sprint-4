# Выбор и настройка мониторинга в системе

## Мотивация

Добавление мониторинга поможет получить ответы на следующие вопросы

1. В какой части системы произошла проблема?
2. Когда произошла проблема?
3. Когда может произойти проблема?
4. Как изменились показатели в сравнении с предыдущим релизом?
5. Как узнавать о пробемах быстрее клиентов?
6. Как часто возникают проблемы определенной категории?
7. Какие проблемы критические, а какие нет?
8. Ошибка старая или привнесена новым релизом?

Анализ и систиматизация показателей мониторинга и алертов позволяет проработать типовые ошибки и разработать план по их устранению, фиксировать ошибки и производить их разбор с командой разработки?

## Выбор подхода к мониторингу

- Balancer: RED или USE если настроить очередь.
- Price Calculation: USE
- Shop DB, MES DB: 4 Golden Signals
- Message QUEUE: 4 Golden Signals
- Cache: RED
- 3d files storage: 4 Golden Signals
- CRM API, CRM API, MES API: 4 Golden Signals
- Internet Shop, CRM, MES: RED

## Метрики

1. Number of dead-letter-exchange letters in RabbitMQ
    Повышенный показатель отображает есть ли ошибки в обработке сообщений. И по тому растет показатель или уменьшается можно сделать предположение и причинах проблемы, исправилась ли проблема после манипуляций.
2. Number of message in flight in RabbitMQ
    Обображает как быстро компоненты системы обраюатывают сообщения. По данному показателю можно принять решение о масштабировании или о необходимости в поиске узких мест в обработке сообщений.
3. Number of requests (RPS) for internet shop API, Number of requests (RPS) for CRM API
Number of requests (RPS) for MES API
    Колличество поступаемых обращений по API, дает понять объем поступаемых запросов и принять решение о необходимости масштабироваться или зашититься от атаки типа DDOS.
4. CPU % for shop API, CPU % for CRM API, CPU % for MES API
    Утилизация ресорсов CPU. Помогает определить достаточность ресурса или как показатель проблем в работае приложения когда CPU не используется, а задачи в очереди.
5. Memory Utilisation for shop API, Memory Utilisation for CRM API, Memory Utilisation for MES API, Memory Utilisation for shop db instance, Memory Utilisation for MES db instance
    Утилизация RAM. Помогает определить достаточность ресурса и определить утечку памяти.
6. Number of connections for shop db instance, Number of connections for MES db instance
    Колличество соединений с БД. Помагает определить проблему с зависшими соединениями или в работе приложения с БД
7. Response time (latency) for shop API, Response time (latency) for CRM API, Response time (latency) for MES API
    Время ответа. Помогает определить проблему в сервисах для дальнейшей дигностики
8. Size of S3 storage, Size of shop db instance, Size of MES db instance
    Занятое пространство. Позволяет определить достаточность ресурса, поймать резкий скачек его уменьшения и спрогнозировать расширение.
9. Number of HTTP 500 for shop API, Number of HTTP 500 for CRM API, Number of HTTP 500 for MES API, Number of HTTP 500 for shop API
    Количество ошибок на стороне сервиса, помогает выявить проблему для дальнейшего анализа.

## План действий

В соотвествии с заданием №1.

1. Создать инстранс Prometheus
2. Создать инстанс Grafana
3. Добавить Prometheus exporter в компоненты системы
4. Настроить Dashboard в Grafana
5. Собрать фактуру и проанализировать
6. Настроить оповещения по пороговым значениям

## Показатель насыщенности

Load Average - один из общих показателей насыщенности на уровне операционной системы. Показатель позволит обнаружить общею проблемы с насыщенностью, недостатком ресурсов или проблему в работе системы как на уровне операционной, так и на уровне компонентов и оборудования. При привышении показателей, необходимо произвести детальную диагностику и ответить на вопросы:
1. В какой области проблема? Дисковая подсистема, RAM, CPU, сеть?
2. Что не так с данной областью, что вызвало данную проблему?
3. Какие действия предпринять для решения проблемы?
4. Как недопустить в дальнейшем повторения проблемы?